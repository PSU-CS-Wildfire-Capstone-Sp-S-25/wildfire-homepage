<nav class="site-nav pv3 ph3 ph4-ns" role="navigation">
  <div class="nav-inner flex-l center items-center justify-between">
    <a href="{{ .Site.Home.RelPermalink }}" class="nav-brand f3 fw2 hover-white white-90 dib no-underline">
      {{ with .Site.Params.site_logo }}
        <img src="{{ urls.RelURL . }}" class="w100 mw5-ns" alt="{{ $.Site.Title }}" />
      {{ else }}
        {{ .Site.Title }}
      {{ end }}
    </a>
    <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-menu">
      <span class="sr-only">Toggle menu</span>
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
    </button>
    <div class="nav-menu flex-l items-center" id="primary-menu">
      {{ partials.Include "i18nlist.html" . }}
      {{ if .Site.Menus.main }}
        <ul class="nav-links {{ compare.Conditional (compare.Eq $.Site.Language.LanguageDirection "rtl") "pr0 ml3" "pl0 mr3" }}">
          {{ range .Site.Menus.main }}
          <li class="list f5 f4-ns fw4 dib {{ compare.Conditional (compare.Eq $.Site.Language.LanguageDirection "rtl") "pl3" "pr3" }} {{ if .HasChildren }}has-children{{ end }}">
            <a class="hover-white white-90 no-underline" href="{{ if compare.Eq .URL "/" }}{{ $.Site.Home.RelPermalink }}{{ else }}{{ .URL | relURL }}{{ end }}" title="{{ lang.Translate "pageTitle" . }}">
              {{ .Name }}
            </a>
            {{ if .HasChildren }}
            <ul class="submenu">
              {{ range .Children }}
              <li class="list f6 fw5 db" style="margin:0;">
                <a class="no-underline" href="{{ .URL | relURL }}" style="display:block; padding:8px 14px; color:#222b5c;">
                  {{ .Name }}
                </a>
              </li>
              {{ end }}
            </ul>
            {{ end }}
          </li>
          {{ end }}
        </ul>
      {{ end }}
      {{ partials.IncludeCached "social/follow.html" . }}
    </div>
  </div>
</nav>
<script>
  (function () {
    var nav = document.querySelector(".site-nav");
    if (!nav) return;
    var toggle = nav.querySelector(".nav-toggle");
    var menu = nav.querySelector("#primary-menu");
    if (!toggle || !menu) return;

    // Hamburger menu toggle
    toggle.addEventListener("click", function () {
      var isOpen = nav.classList.toggle("is-open");
      toggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
    });

    // Close menu when clicking a link on mobile
    menu.addEventListener("click", function (event) {
      var link = event.target.closest("a");
      // Only close for links that are NOT parent menu items with children
      if (!link) return;
      var parentLi = link.closest("li");
      if (parentLi && parentLi.classList.contains("has-children") && link === parentLi.querySelector(":scope > a")) {
        return; // Don't close for parent menu items
      }
      if (window.innerWidth <= 840) {
        nav.classList.remove("is-open");
        toggle.setAttribute("aria-expanded", "false");
      }
    });

    // Desktop: hover support for submenus
    var hasChildrenItems = nav.querySelectorAll(".has-children");
    hasChildrenItems.forEach(function (item) {
      var submenu = item.querySelector(".submenu");
      if (!submenu) return;

      item.addEventListener("mouseenter", function () {
        if (window.innerWidth > 840) {
          submenu.style.display = "block";
        }
      });
      item.addEventListener("mouseleave", function () {
        if (window.innerWidth > 840) {
          submenu.style.display = "none";
        }
      });
    });

    // Close submenus on desktop when clicking outside
    document.addEventListener("click", function (e) {
      if (window.innerWidth > 840 && !nav.contains(e.target)) {
        hasChildrenItems.forEach(function (item) {
          var submenu = item.querySelector(".submenu");
          if (submenu) submenu.style.display = "none";
        });
      }
    });
  })();
</script>
